<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><meta name="baidu-site-verification"><title>MySQL备份与恢复 | 艾利克斯工作室</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="艾利克斯工作室" type="application/atom+xml">
</head><link rel="stylesheet" type="text/css" href="/plugins/prettify/doxy.css"><script type="text/javascript" src="/js/ready.js" async></script><body><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">LITREILY</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">艾利克斯工作室</a></h1></div><p class="m-desc">路在脚下<br>The road is under your feet.</p><div class="m-nav"><ul><li><span class="dot">●</span><a href="/archives/">归档</a></li><li><span class="dot">●</span><a href="/categories/">分类</a></li><li><span class="dot">●</span><a href="/tags/">标签</a></li><li><span class="dot">●</span><a href="/about/">关于</a></li><li><span class="dot">●</span><a href="/Cooperation/">合作</a></li><li><span class="dot">●</span><a href="/atom.xml">RSS</a></li><li><span class="dot">●</span><a href="/Case/">案例</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="搜索" onfocus="if(this.value=='搜索'){this.value='';}" onblur="if(this.value==''){this.value='搜索';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">MySQL备份与恢复</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/2020/04/03/MySQL%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/">2020-04-03</a></span><span class="p-category"><i class="fa fa-folder"></i><a href="/categories/%E6%8A%80%E6%9C%AF%E8%AF%95%E9%AA%8C/">技术试验</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><p>备份的主要目的是灾难恢复，备份还可以测试应用、回滚数据修改、查询历史数据、审计等。</p>
<a id="more"></a>
<h1 id="一、MySQL完全备份与恢复"><a href="#一、MySQL完全备份与恢复" class="headerlink" title="一、MySQL完全备份与恢复"></a>一、MySQL完全备份与恢复</h1><p>1、数据备份的重要性<br>在企业中数据的价值至关重要，数据保障了企业业务的正常运行。因此，数据的安全性及数据的可靠性是运维的重中之重，任何数据的丢失都可能对企业产生严重的后果。<br>通常情况下造成数据丢失的原因如下几种：</p>
<pre><code>程序错误
人为操作错误
运算错误
磁盘故障
灾难（火灾、地震）和盗窃</code></pre><h1 id="二、数据库备份类型"><a href="#二、数据库备份类型" class="headerlink" title="二、数据库备份类型"></a>二、数据库备份类型</h1><p>1、从物理与逻辑的角度：<br>数据库备份可以分为物理备份和逻辑备份。物理备份是对数据库操作系统的物理文件（如数据文件、日志文件等）的备份。这种类型的备份适用于在出现问题时需要快速恢复的大型重要数据库。</p>
<pre><code>物理备份又可以分为冷备份（脱机备份）、热备份（联机备份）和温备份。
冷备份：在数据库关闭状态下进行备份操作；

热备份：在数据库处于运行状态时进行备份操作，该备份方法依赖数据库的日志文件；

温备份：数据库锁定表格（不可写入，但可读取）的状态下进行备份；

逻辑备份是对数据库逻辑组件（如表等数据库对象）的备份，表示为逻辑数据库结构（create database、create table语句）和内容（insert语句或分隔文本文件）的信息。这种类型的备份使用于可以编辑数据值或表结构较小的数据量，或者在不同的机器体系上重新创建数据。</code></pre><p>2、从数据库的备份策略角度：</p>
<pre><code>从数据库的备份策略角度，数据库的备份可分为完全备份、差异备份和增量备份。其中呢，完整备份是实现差异、增量备份的基础。

完整备份：每次对数据进行完整的备份，即对整个数据库的备份。备份与恢复的操作非常简单，但是数据存在大量的重复，会占用大量的磁盘空间，备份的时间也很长。

差异备份：备份那些自从上次完全备份之后被修改过的所有文件，备份的时间点是从上次完整备份起，备份数据会越来越大，恢复数据时，只需恢复上次的完全备份和最近的一次差异备份。

增量备份：只有在那些在上次完全备份或增量备份后被修改的文件才会被备份，以上次完整备份或上次增量备份的时间为时间点，仅仅备份这之间的数据变化，因而备份的数据量也小，占用空间小，备份速度快，但恢复时，需要从上一次的完整备份开始到最后一次增量备份之间的所有增量依次恢复，一旦中间的数据发生损坏，将导致数据的丢失。</code></pre><h1 id="三、常见的备份方法"><a href="#三、常见的备份方法" class="headerlink" title="三、常见的备份方法"></a>三、常见的备份方法</h1><p>MySQL数据库的备份可以采用很多种方式，如直接打包数据库文件（物理冷备份）、专用备份工具（mysqldump）、二进制日志增量备份、第三方工具备份等。</p>
<p>1、物理冷备份<br>物理冷备份时需要在数据库处于关闭状态下，能够较好地保证数据库的完整性。物理冷备份一般用于非核心业务，这类业务一般都允许中断，物理冷备份的特点就是速度快，恢复时也是最为简单。</p>
<p>2、专用备份工具mysqldump或mysqlhotcopy<br>mysqldump程序和mysqlhotcopy都可以做备份。mysqqldump是客户端常用逻辑备份程序，能够产生一组被执行以再现原始数据库对象定义和表数据的SQL语句。它可以转储一个到多个MySQL数据库，对其进行备份或传输到远程SQL服务器。mysqldump更为通用，因为它可以备份各种表。mysqlhotcopy仅适用于某些存储引擎。</p>
<p>3、通过启用二进制日志进行增量备份<br>MySQL支持增量备份，进行增量备份时必须启用二进制日志。二进制日志文件为用户提供复制，对执行备份点后进行的数据库更改所需的信息进行恢复。如果进行增量备份（包含自上次完全备份或增量备份以来发生的数据修改），需要刷新二进制日志。</p>
<h1 id="四、数据库完全备份操作"><a href="#四、数据库完全备份操作" class="headerlink" title="四、数据库完全备份操作"></a>四、数据库完全备份操作</h1><p>1、备份前准备</p>
<pre><code>[root@centos01 ~]# mysqladmin -u root password  &lt;!--mysql数据库设置密码--&gt;
New password:             &lt;!--输入密码--&gt;
Confirm new password:        &lt;!--确认密码--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123    &lt;!--登录MySQL数据库--&gt;
mysql&gt; create database benet;        &lt;!--创建benet数据库--&gt;
mysql&gt; use benet;             &lt;!--切换到benet数据库创建表--&gt;
mysql&gt; create table 一班学生成绩 (姓名 char(3),班级 char(5),学号 char(8),语文 char(3),
数学char(3),英语 char(3),理综 char(3), primary key (学号));  
&lt;!--创建表，表名字为一班学生成绩，第一列名字是姓名，第二列名字为班级，第三列名字
为学号，第四列名字为语文，第五列名字为数学，第六列名字为英语，第七列名字为理综--&gt;
mysql&gt; insert into 一班学生成绩 value (&#39;张三&#39;,&#39;一班&#39;,&#39;20170822&#39;,&#39;110&#39;,&#39;105&#39;,&#39;92&#39;,&#39;235&#39;);  
                   &lt;!--表中插入数据--&gt;
mysql&gt;  insert into 一班学生成绩 value (&#39;李四&#39;,&#39;一班&#39;,&#39;20170820&#39;,&#39;95&#39;,&#39;115&#39;,&#39;110&#39;,&#39;260&#39;);  
                   &lt;!--表中插入数据--&gt;
mysql&gt; insert into 一班学生成绩 value (&#39;王五&#39;,&#39;一班&#39;,&#39;20170818&#39;,&#39;95&#39;,&#39;103&#39;,&#39;108&#39;,&#39;270&#39;);  
                   &lt;!--表中插入数据--&gt;
mysql&gt; insert into 一班学生成绩 value (&#39;赵六&#39;,&#39;一班&#39;,&#39;20170816&#39;,&#39;100&#39;,&#39;109&#39;,&#39;112&#39;,&#39;265&#39;); 
                   &lt;!--表中插入数据--&gt;
mysql&gt; select * from benet.一班学生成绩;   &lt;!--查看一班学生成绩表中所有数据--&gt;</code></pre><p><img src="/images/sql1.png" alt="alt"><br>2、物理冷备份与恢复<br>物理冷备份一般用tar命令直接打包数据库文件夹，而在进行备份之前需要使用“systemctl stop mysqld”命令关闭mysql服务。</p>
<p>1）备份数据库<br>创建一个/bak目录作为备份数据存储路径，使用tar创建备份文件。整个数据库文件夹备份属于完全备份。</p>
<pre><code>[root@centos01 ~]# systemctl stop mysqld  &lt;!--停止mysql服务--&gt;
[root@centos01 ~]mkdir /bak/   &lt;!--创建存储备份目录--&gt;
[root@centos01 ~]# tar zcf /bak/mysql_all-$(date +%F).mysql.gz /usr/local/mysql/data/    
                 &lt;!--直接tar打包数据库文件--&gt;
[root@centos01 ~]# ls /bak/     &lt;!--查看备份的数据--&gt;
-rw-r--r-- 1 root root 766598 10月 31 03:57 /bak/mysql_all-2019-10-31.mysql.gz</code></pre><p>2）恢复数据库</p>
<pre><code>[root@centos01 ~]mkdir test  &lt;!--创建恢复数据目录--&gt;
[root@centos01 ~]# tar zxvf /bak/mysql_all-2019-10-31.mysql.gz  -C ./test/   
                &lt;!--解压缩备份数据到恢复目录--&gt;
[root@centos01 data]# cd /usr/local/mysql/data/  &lt;!--进入数据原始位置--&gt;
[root@centos01 data]# rm -rf ./*  &lt;!--删除数据--&gt;
[root@centos01 ~]# cd ./test/usr/local/mysql/data/  &lt;!--切换到恢复目录--&gt;
[root@centos01 date]#mv ./* /usr/local/mysql/data/    &lt;!--将恢复目录数据恢复到原始位置--&gt;
[root@centos01 ~]# systemctl start mysqld  &lt;!--启动mysql服务--&gt;</code></pre><p>3、mysqldump备份与恢复<br>通过mysqldump命令可以将指定的库、表或全部的库导出为SQL脚本，便于该命令在不同版本的MySQL服务器上使用。<br>1）备份恢复所有数据库</p>
<pre><code>[root@centos01 ~]# mysqldump -uroot -ppwd@123 --opt --all-databases &gt; ./test/benet_databases.sql     &lt;!--备份所有库,opt选项是优化执行速度--&gt;
[root@centos01 ~]# mysql -uroot -p     &lt;!--登录数据库--&gt;
Enter password:          &lt;!--数据密码--&gt;
mysql&gt; show databases;         &lt;!--查看所有数据库--&gt;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| benet              |
| mysql              |
| performance_schema |
| test               |
+--------------------+
mysql&gt; drop database benet;  &lt;!--删除benet数据库--&gt;
mysql&gt; show databases;      &lt;!--查看数据库是否删除--&gt;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| test               |
+--------------------+
[root@centos01 ~]# mysql -u root -p &lt; ./test/benet_databases.sql 
Enter password:     &lt;!--恢复所有数据库--&gt;
mysql&gt; show databases;     &lt;!--查看数据库是否恢复--&gt;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| benet              |
| mysql              |
| performance_schema |
| test               |
+--------------------+
mysql&gt; source ./test/benet_databases.sql 
             &lt;!--也可以通过这种方法恢复误删除的数据库--&gt;</code></pre><p>2）备份恢复数据库中的表</p>
<pre><code>[root@centos01 ~]# mysqldump -uroo t -ppwd@123 benet 一班学生成绩 &gt; ./test/benet_一班学生成绩.sql   
                         &lt;!--备份数据库下的表--&gt;
[root@centos01 ~]# mysql -uroot -p       &lt;!--登录数据库--&gt;
Enter password:        &lt;!--输入密码--&gt;
mysql&gt; use benet;      &lt;!--切换到benet数据库--&gt;
mysql&gt; drop table 一班学生成绩;      &lt;!--删除一班学生成绩表--&gt;
mysql&gt; show tables;        &lt;!--查看表是否删除--&gt; 
Empty set (0.00 sec)
[root@centos01 ~]# mysql -uroot -p benet &lt; ./test/benet_一班学生成绩.sql  
                           &lt;!--恢复误删除的表--&gt;
[root@centos01 ~]# mysql -uroot -p    &lt;!--登录数据库--&gt;
Enter password:           &lt;!--输入密码--&gt;
mysql&gt; use benet;         &lt;!--切换到benet数据库--&gt;
Database changed
mysql&gt; show tables;    &lt;!--查看误删除的表是否恢复--&gt;
+--------------------+
| Tables_in_benet    |
+--------------------+
| 一班学生成绩       |
+--------------------+
1 row in set (0.00 sec)</code></pre><h1 id="五、MySQL增量备份与恢复"><a href="#五、MySQL增量备份与恢复" class="headerlink" title="五、MySQL增量备份与恢复"></a>五、MySQL增量备份与恢复</h1><p>使用mysqldump进行完全备份，备份的数据中有重复数据，备份时间与恢复时间过长。而增量备份就是备份自上一次备份之后增加或改变的文件或内容。</p>
<p>1、MySQL增量备份的特点<br>与完全备份不同，增量备份没有重复数据，备份量不大，时间短；但其恢复麻烦，需要上次完全备份及完全备份之后所有的增量备份才能恢复，而且要对所有增量备份进行逐个反推恢复。可以通过MySQL提供的二进制日志间接实现增量备份。</p>
<p>2、MySQL增量备份与恢复<br>二进制日志保存了所有更新或者可能更新数据库的操作。二进制日志在启动MySQL服务器后开始记录，并在文件达到二进制日志所设置的最大值或者接收到flush logs命令后重新创建新的日志文件，生成二进制文件序列，并及时把这些日志保存到安全的存储位置，即可完成一个时间段的增量备份。<br>要进行MySQL的增量备份，首先要开启二进制日志功能，开启MySQL的二进制日志功能的实现方法如下：</p>
<pre><code>[root@centos01 ~]# vim /etc/my.cnf       &lt;!--进入MySQL配置文件--&gt;
.......    &lt;!--此处省略部分内容--&gt;
log-bin=mysql-bin      &lt;!--开启二进制日志功能--&gt;
[root@centos01 ~]# systemctl restart mysqld   &lt;!--重启MySQL服务--&gt;
[root@centos01 ~]# ls -l /usr/local/mysql/data/
......             &lt;!--此处省略部分内容--&gt;
-rw-rw---- 1 mysql mysql    27299 10月 31 00:00 mysql-bin.000001
-rw-rw---- 1 mysql mysql  1031892 10月 31 00:00 mysql-bin.000002
-rw-rw---- 1 mysql mysql     1574 10月 31 14:13 mysql-bin.000003
-rw-rw---- 1 mysql mysql   507535 11月  1 09:37 mysql-bin.000004
-rw-rw---- 1 mysql mysql   507229 11月  1 09:40 mysql-bin.000005
-rw-rw---- 1 mysql mysql       95 11月  1 09:37 mysql-bin.index
drwx------ 2 mysql mysql     4096 10月 31 00:00 performance_schema
drwxr-xr-x 2 mysql mysql       20 10月 30 23:56 test</code></pre><p>1）增量备份</p>
<pre><code>[root@centos01 ~]# mysqladmin -uroot -ppwd@123 flush-logs  &lt;!--刷新二进制日志--&gt;
[root@centos01 ~]# ls -l /usr/local/mysql/data/     &lt;!--查看二进制日志文件--&gt;
......   &lt;!--此处省略部分内容--&gt;
-rw-rw---- 1 mysql mysql    27299 10月 31 00:00 mysql-bin.000001
-rw-rw---- 1 mysql mysql  1031892 10月 31 00:00 mysql-bin.000002
-rw-rw---- 1 mysql mysql     1574 10月 31 14:13 mysql-bin.000003
-rw-rw---- 1 mysql mysql   507535 11月  1 09:37 mysql-bin.000004
-rw-rw---- 1 mysql mysql   507272 11月  1 09:49 mysql-bin.000005
-rw-rw---- 1 mysql mysql      107 11月  1 09:49 mysql-bin.000006
-rw-rw---- 1 mysql mysql      114 11月  1 09:49 mysql-bin.index
drwx------ 2 mysql mysql     4096 10月 31 00:00 performance_schema
drwxr-xr-x 2 mysql mysql       20 10月 30 23:56 test
[root@centos01 ~]# mysql -uroot -ppwd@123  &lt;!--登录mysql数据库--&gt;
mysql&gt; use benet;           &lt;!--切换到benet数据库--&gt;
mysql&gt; insert into 一班学生成绩 value (&#39;李宁&#39;,&#39;二班&#39;,&#39;20170824&#39;,&#39;92&#39;,&#39;98&#39;,&#39;105&#39;,&#39;235&#39;);            
                    &lt;!--录入新的数据--&gt;
Query OK, 1 row affected (0.01 sec)
mysql&gt; insert into 一班学生成绩 value (&#39;陈铭&#39;,&#39;二班&#39;,&#39;20170826&#39;,&#39;111&#39;,&#39;107&#39;,&#39;96&#39;,&#39;204&#39;);           
                    &lt;!--录入新的数据--&gt;
Query OK, 1 row affected (0.00 sec)
mysql&gt; select *from 一班学生成绩;    &lt;!--查看新数据是否录入--&gt;
+--------+--------+----------+--------+--------+--------+--------+
| 姓名   | 班级   | 学号     | 语文   | 数学   | 英语   | 理综   |
+--------+--------+----------+--------+--------+--------+--------+
| 赵六   | 一班   | 20170816 | 100    | 109    | 112    | 265    |
| 王五   | 一班   | 20170818 | 95     | 103    | 108    | 270    |
| 李四   | 一班   | 20170820 | 95     | 115    | 110    | 260    |
| 张三   | 一班   | 20170822 | 110    | 105    | 92     | 235    |
| 李宁   | 二班   | 20170824 | 92     | 98     | 105    | 235    |
| 陈铭   | 二班   | 20170826 | 111    | 107    | 96     | 204    |
+--------+--------+----------+--------+--------+--------+--------+
6 rows in set (0.00 sec)
[root@centos01 ~]# mysqladmin -uroot -ppwd@123 flush-logs  
                          &lt;!--刷新二进制日志--&gt;
[root@centos01 ~]# ls -l /usr/local/mysql/data/    
                               &lt;!--查看二进制日志文件--&gt;
......          &lt;!--此处省略部分内容--&gt;
-rw-rw---- 1 mysql mysql    27299 10月 31 00:00 mysql-bin.000001
-rw-rw---- 1 mysql mysql  1031892 10月 31 00:00 mysql-bin.000002
-rw-rw---- 1 mysql mysql     1574 10月 31 14:13 mysql-bin.000003
-rw-rw---- 1 mysql mysql   507535 11月  1 09:37 mysql-bin.000004
-rw-rw---- 1 mysql mysql   507272 11月  1 09:49 mysql-bin.000005
-rw-rw---- 1 mysql mysql      649 11月  1 09:58 mysql-bin.000006
-rw-rw---- 1 mysql mysql      107 11月  1 09:58 mysql-bin.000007
-rw-rw---- 1 mysql mysql      133 11月  1 09:58 mysql-bin.index
drwx------ 2 mysql mysql     4096 10月 31 00:00 performance_schema
drwxr-xr-x 2 mysql mysql       20 10月 30 23:56 test
[root@centos01 ~]# cp /usr/local/mysql/data/mysql-bin.000006 /root/test/   
                            &lt;!--复制二进制日志--&gt;</code></pre><p>2）模拟误操作删除一班学生成绩表</p>
<pre><code>[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;drop table benet.一班学生成绩;&#39;       
                    &lt;!--删除一班学生成绩表--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;   
                      &lt;!--查看表是否删除--&gt;
ERROR 1146 (42S02) at line 1: Table &#39;benet.一班学生成绩&#39; doesn&#39;t exist
3）恢复误删除的表
[root@centos01 ~]# mysql -uroot -ppwd@123 &lt; ./test/benet_databases.sql   
                     &lt;!--恢复完全备份--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;        
                        &lt;!--查看完全备份数据是否恢复--&gt;
+--------+--------+----------+--------+--------+--------+--------+
| 姓名   | 班级   | 学号     | 语文   | 数学   | 英语   | 理综   |
+--------+--------+----------+--------+--------+--------+--------+
| 赵六   | 一班   | 20170816 | 100    | 109    | 112    | 265    |
| 王五   | 一班   | 20170818 | 95     | 103    | 108    | 270    |
| 李四   | 一班   | 20170820 | 95     | 115    | 110    | 260    |
| 张三   | 一班   | 20170822 | 110    | 105    | 92     | 235    |
+--------+--------+----------+--------+--------+--------+--------+
[root@centos01 ~]# mysqlbinlog --no-defaults /root/test/mysql-bin.000006 |mysql -u root -p 
                   &lt;!--恢复增量备份--&gt;
Enter password:       &lt;!--输入密码--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;      
                     &lt;!--查看增量恢复数据是否恢复--&gt;
+--------+--------+----------+--------+--------+--------+--------+
| 姓名   | 班级   | 学号     | 语文   | 数学   | 英语   | 理综   |
+--------+--------+----------+--------+--------+--------+--------+
| 赵六   | 一班   | 20170816 | 100    | 109    | 112    | 265    |
| 王五   | 一班   | 20170818 | 95     | 103    | 108    | 270    |
| 李四   | 一班   | 20170820 | 95     | 115    | 110    | 260    |
| 张三   | 一班   | 20170822 | 110    | 105    | 92     | 235    |
| 李宁   | 二班   | 20170824 | 92     | 98     | 105    | 235    |
| 陈铭   | 二班   | 20170826 | 111    | 107    | 96     | 204    |
+--------+--------+----------+--------+--------+--------+--------+</code></pre><p>3、基于位置恢复</p>
<pre><code>[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;drop table benet.一班学生成绩;&#39;   
                &lt;!--删除一班学生成绩表--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;  
                 &lt;!--查看表是否删除--&gt;
ERROR 1146 (42S02) at line 1: Table &#39;benet.一班学生成绩&#39; doesn&#39;t exist
[root@centos01 ~]# mysql -uroot -ppwd@123 &lt; ./test/benet_databases.sql     
               &lt;!--恢复完全备份--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;     
               &lt;!--查看完全备份是否恢复--&gt;
+--------+--------+----------+--------+--------+--------+--------+
| 姓名   | 班级   | 学号     | 语文   | 数学   | 英语   | 理综   |
+--------+--------+----------+--------+--------+--------+--------+
| 赵六   | 一班   | 20170816 | 100    | 109    | 112    | 265    |
| 王五   | 一班   | 20170818 | 95     | 103    | 108    | 270    |
| 李四   | 一班   | 20170820 | 95     | 115    | 110    | 260    |
| 张三   | 一班   | 20170822 | 110    | 105    | 92     | 235    |
+--------+--------+----------+--------+--------+--------+--------+
[root@centos01 ~]# mysqlbinlog --no-defaults /root/test/mysql-bin.000006       
                &lt;!--查看二进制日志文件确认恢复的位置或时间点--&gt;
......         &lt;!--此处省略部分内容--&gt;
# at 176                  &lt;!--at就是我们称之为操作ID，下面紧跟的是时间标记--&gt;
#191101  9:55:33 server id 1  end_log_pos 329   Query   thread_id=9 exec_time=0 error_code=0
use benet/*!*/;
SET TIMESTAMP=1572573333/*!*/;
insert into 一班学生成绩 value (&#39;李宁&#39;,&#39;二班&#39;,&#39;20170824&#39;,&#39;92&#39;,&#39;98&#39;,&#39;105&#39;,&#39;235&#39;)
/*!*/;
# at 329
#191101  9:55:33 server id 1  end_log_pos 356   Xid = 278
COMMIT/*!*/;
# at 356
#191101  9:55:43 server id 1  end_log_pos 425   Query   thread_id=9 exec_time=0 error_code=0
SET TIMESTAMP=1572573343/*!*/;
BEGIN
/*!*/;
# at 425       &lt;!--at就是我们称之为操作ID，下面紧跟的是时间标记--&gt;
#191101  9:55:43 server id 1  end_log_pos 579   Query   thread_id=9 exec_time=0 error_code=0
SET TIMESTAMP=1572573343/*!*/;
insert into 一班学生成绩 value (&#39;陈铭&#39;,&#39;二班&#39;,&#39;20170826&#39;,&#39;111&#39;,&#39;107&#39;,&#39;96&#39;,&#39;204&#39;)
/*!*/;
[root@centos01 ~]# mysqlbinlog --no-defaults --stop-position=&#39;425&#39; /root/test/mysql-bin.000006 |mysql -uroot -p       &lt;!--基于ID恢复增量备份--&gt;
Enter password:       &lt;!--输入密码--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;    
               &lt;!--查看数据是否恢复--&gt;
+--------+--------+----------+--------+--------+--------+--------+
| 姓名   | 班级   | 学号     | 语文   | 数学   | 英语   | 理综   |
+--------+--------+----------+--------+--------+--------+--------+
| 赵六   | 一班   | 20170816 | 100    | 109    | 112    | 265    |
| 王五   | 一班   | 20170818 | 95     | 103    | 108    | 270    |
| 李四   | 一班   | 20170820 | 95     | 115    | 110    | 260    |
| 张三   | 一班   | 20170822 | 110    | 105    | 92     | 235    |
| 李宁   | 二班   | 20170824 | 92     | 98     | 105    | 235    |
+--------+--------+----------+--------+--------+--------+--------+</code></pre><p>上述命令中“–stop-position”指定的是停止的位置，如果仅恢复“陈铭”的信息，跳过“李宁”的信息恢复，可以使用“–start-position”选项指定开始恢复数据的位置。这时所恢复的数据是从指定位置开始直到二进制日志文件的最后。</p>
<pre><code>[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;drop table benet.一班学生成绩;&#39;    
                   &lt;!--删除一班学生成绩表--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;  
                  &lt;!--查看表是否删除--&gt;
ERROR 1146 (42S02) at line 1: Table &#39;benet.一班学生成绩&#39; doesn&#39;t exist
[root@centos01 ~]# mysql -uroot -ppwd@123 &lt; ./test/benet_databases.sql      
                          &lt;!--恢复完全备份--&gt;
[root@centos01 ~]# mysqlbinlog --no-defaults --start-position=&#39;425&#39; /root/test/mysql-bin.000006 |mysql -uroot -p       &lt;!--基于ID恢复增量备份--&gt;
Enter password:        &lt;!--输入密码--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;    
                 &lt;!--查看数据是否恢复--&gt;
+--------+--------+----------+--------+--------+--------+--------+
| 姓名   | 班级   | 学号     | 语文   | 数学   | 英语   | 理综   |
+--------+--------+----------+--------+--------+--------+--------+
| 赵六   | 一班   | 20170816 | 100    | 109    | 112    | 265    |
| 王五   | 一班   | 20170818 | 95     | 103    | 108    | 270    |
| 李四   | 一班   | 20170820 | 95     | 115    | 110    | 260    |
| 张三   | 一班   | 20170822 | 110    | 105    | 92     | 235    |
| 陈铭   | 二班   | 20170826 | 111    | 107    | 96     | 204    |
+--------+--------+----------+--------+--------+--------+--------+</code></pre><p>4、基于时间点恢复<br>基于时间点恢复数据所使用的选项是“–stop-datetime”，指定的时间同样也是查询二进制日志所得。执行一下操作可以实现仅恢复到9:55:43之前的数据，即不恢复“陈铭”的信息。</p>
<pre><code>[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;drop table benet.一班学生成绩;&#39; 
                      &lt;!--删除一班学生成绩表--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;  
                 &lt;!--查看表是否删除--&gt;
ERROR 1146 (42S02) at line 1: Table &#39;benet.一班学生成绩&#39; doesn&#39;t exist
[root@centos01 ~]# mysql -uroot -ppwd@123 &lt; ./test/benet_databases.sql    
                   &lt;!--恢复完全备份--&gt;
[root@centos01 ~]# mysqlbinlog --no-defaults --stop-datetime=&#39;2019-11-01  9:55:43&#39; /root/test/mysql-bin.000006 |mysql -uroot -p     
                         &lt;!--基于时间点恢复增量备份--&gt;
Enter password:       &lt;!--输入密码--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;    
                           &lt;!--查看数据是否恢复--&gt;
+--------+--------+----------+--------+--------+--------+--------+
| 姓名   | 班级   | 学号     | 语文   | 数学   | 英语   | 理综   |
+--------+--------+----------+--------+--------+--------+--------+
| 赵六   | 一班   | 20170816 | 100    | 109    | 112    | 265    |
| 王五   | 一班   | 20170818 | 95     | 103    | 108    | 270    |
| 李四   | 一班   | 20170820 | 95     | 115    | 110    | 260    |
| 张三   | 一班   | 20170822 | 110    | 105    | 92     | 235    |
| 李宁   | 二班   | 20170824 | 92     | 98     | 105    | 235    |
+--------+--------+----------+--------+--------+--------+--------+
执行以下操作可以实现仅恢复“陈铭”的信息，跳过“李宁”的信息恢复

[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;drop table benet.一班学生成绩;&#39;   
                      &lt;!--删除一班学生成绩表--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;    
                 &lt;!--查看表是否删除--&gt;
ERROR 1146 (42S02) at line 1: Table &#39;benet.一班学生成绩&#39; doesn&#39;t exist
[root@centos01 ~]# mysql -uroot -ppwd@123 &lt; ./test/benet_databases.sql     
                         &lt;!--恢复完全备份--&gt;
[root@centos01 ~]# mysqlbinlog --no-defaults --start-datetime=&#39;2019-11-01 9:55:43&#39;
/root/test/mysql-bin.000006 |mysql -uroot -p      
                      &lt;!--基于时间恢复增量备份--&gt;
Enter password:        &lt;!--输入密码--&gt;
[root@centos01 ~]# mysql -uroot -ppwd@123 -e &#39;select * from benet.一班学生成绩;&#39;    
                       &lt;!--查看数据是否恢复--&gt;
+--------+--------+----------+--------+--------+--------+--------+
| 姓名   | 班级   | 学号     | 语文   | 数学   | 英语   | 理综   |
+--------+--------+----------+--------+--------+--------+--------+
| 赵六   | 一班   | 20170816 | 100    | 109    | 112    | 265    |
| 王五   | 一班   | 20170818 | 95     | 103    | 108    | 270    |
| 李四   | 一班   | 20170820 | 95     | 115    | 110    | 260    |
| 张三   | 一班   | 20170822 | 110    | 105    | 92     | 235    |
| 陈铭   | 二班   | 20170826 | 111    | 107    | 96     | 204    |
+--------+--------+----------+--------+--------+--------+--------+</code></pre></div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">本文作者：</span><span class="p-copytight-value"><a href="mailto:Likj128@126.com">Alexis (KangJ)</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">本文链接：</span><span class="p-copytight-value"><a href="/2020/04/03/MySQL%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/">http://likj128.github.io/2020/04/03/MySQL备份与恢复/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">版权声明：</span><span class="p-copytight-value">本博客所有文章除特殊声明外，均采用<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>许可协议。转载请注明出处 <a href="http://likj128.github.io">Alexis (KangJ)的博客</a>！</span></div></blockquote></div></article><div class="p-info box"><span class="p-tags"><i class="fa fa-tag"></i><a href="/tags/MySQL/">MySQL</a></span></div><aside id="toc"><div class="toc-title">目录</div><nav><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、MySQL完全备份与恢复"><span class="toc-number">1.</span> <span class="toc-text">一、MySQL完全备份与恢复</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、数据库备份类型"><span class="toc-number">2.</span> <span class="toc-text">二、数据库备份类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、常见的备份方法"><span class="toc-number">3.</span> <span class="toc-text">三、常见的备份方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四、数据库完全备份操作"><span class="toc-number">4.</span> <span class="toc-text">四、数据库完全备份操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五、MySQL增量备份与恢复"><span class="toc-number">5.</span> <span class="toc-text">五、MySQL增量备份与恢复</span></a></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="prev" href="/2020/04/05/%E8%B7%AF%E7%BA%BF%E8%BD%A8%E8%BF%B9%E7%9A%843D%E5%8A%A8%E7%94%BB%E5%B1%95%E7%A4%BA/">&lt; 路线轨迹的3D动画展示</a><a class="next" href="/2020/04/03/varchar-int-%E6%9F%A5%E8%AF%A2-%E5%88%B0%E5%BA%95%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E8%B5%B0%E7%B4%A2%E5%BC%95%EF%BC%9F/">varchar int 查询 到底什么情况下走索引？ &gt;</a></div><div id="valine-comment"><style type="text/css">.v * { color: #CECECE; }
.v a { color: #0F9FB4; }
.v a:hover { color: #216C73; }
.v li { list-style: inherit; }
.v .vwrap { border: 1px solid #223441; border-radius: 0; }
.v .vwrap:hover { box-shadow: 0 0 6px 1px #223441; }
.v .vbtn { border-radius: 0; color: #cecece; background: none; }
.v .vlist .vcard .vh { border-bottom-color: #293D4E; }
.v .vwrap .vheader .vinput { border-bottom-color: #223441; }
.v .vwrap .vheader .vinput:focus { border-bottom-color: #339EB4; }
.v code, .v pre,.v .vlist .vcard .vhead .vsys { background: #203240; }
.v code, .v pre { color: #F0F0F0; font-size: 95%; }
.v .vlist .vcard .vcontent.expand:before { background: linear-gradient(180deg,hsla(206,33%,19%,0),hsla(206,33%,19%,.9)); }
.v .vlist .vcard .vcontent.expand:after { background: hsla(206,33%,19%,.9); }</style><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'99FfVECWi1xns2SAjWOtTNza-gzGzoHsz',
  appKey:'6t7I76O3iToh6BGjc5rjWqDX',
  lang: 'zh-cn',
  placeholder:'ヾﾉ≧∀≦)o Come on, say something...',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></section><footer><p>Copyright © 2020 - 2020 <a href="/." rel="nofollow">艾利克斯工作室</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Personal by<a rel="nofollow" target="_blank" href="https://alexisli.cn"> Alexis.</a>Powered by<a rel="nofollow" target="_blank" href="http://www.beianbeian.com/beianxinxi/f72222db0e8cf7f7b49ceee25f65c49e.html"> 晋ICP备19013202号.</a></p></footer></div></div></div><script type="text/javascript" src="/plugins/prettify/prettify.js"></script><script type="text/javascript" src="/js/search.js"></script><script type="text/javascript" src="/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"></body></html>